<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mybatis.resume">
    
    <!-- 이력서 기본 정보 저장 -->
    <insert id="insertResume" parameterType="map" useGeneratedKeys="true" keyProperty="resume_id">
        INSERT INTO resume (
            id, resume_photo, resume_title, is_default
        ) VALUES (
            #{id}, #{resumePhoto}, #{resumeTitle}, #{isDefault}
        )
    </insert>

    <!-- 기존 기본 이력서 해제 -->
    <update id="resetDefaultResume" parameterType="map">
        UPDATE resume 
        SET is_default = false 
        WHERE id = #{id} 
        AND is_default = true
    </update>
    
    <!-- 이력서 목록 조회 (간단한 정보만) -->
    <select id="getResumeList" parameterType="string" resultType="map">
        SELECT 
            resume_id, 
            resume_title, 
            is_default,
            created_at,
            updated_at
        FROM resume
        WHERE id = #{id}
        ORDER BY created_at DESC
    </select>

    <!-- 이력서 상세 정보 조회 -->
    <select id="getResumeById" parameterType="map" resultType="map">
        SELECT *
        FROM resume
        WHERE resume_id = #{resumeId}
    </select>

    <!-- 학력 정보 관련 쿼리 -->
    <insert id="insertEducation" parameterType="map">
        INSERT INTO r_education (
            resume_id,
            school_type,
            school_name,
            major,
            admission_date,
            graduation_date,
            max_score,
            score
        ) VALUES (
            #{resumeId},
            #{schoolType},
            #{schoolName},
            #{major},
            #{admissionDate},
            #{graduationDate},
            #{maxScore},
            #{score}
        )
    </insert>

    <select id="getEducation" parameterType="int" resultType="map">
        SELECT *
        FROM r_education
        WHERE resume_id = #{resumeId}
        ORDER BY admission_date DESC
    </select>

    <!-- 언어능력 관련 쿼리 -->
    <insert id="insertLanguageSkill" parameterType="map">
        INSERT INTO r_language_skill (
            resume_id,
            language_name,
            speaking_level,
            test_name,
            score,
            acquisition_date
        ) VALUES (
            #{resumeId},
            #{languageName},
            #{speakingLevel},
            #{testName},
            #{score},
            #{acquisitionDate}
        )
    </insert>

    <select id="getLanguageSkill" parameterType="int" resultType="map">
        SELECT *
        FROM r_language_skill
        WHERE resume_id = #{resumeId}
        ORDER BY acquisition_date DESC
    </select>

    <!-- 자격증 관련 쿼리 -->
    <insert id="insertCertificate" parameterType="map">
        INSERT INTO r_certificate (
            resume_id,
            certificate_name,
            issuing_organization,
            acquisition_date
        ) VALUES (
            #{resumeId},
            #{certificateName},
            #{issuingOrganization},
            #{acquisitionDate}
        )
    </insert>

    <select id="getCertificate" parameterType="int" resultType="map">
        SELECT *
        FROM r_certificate
        WHERE resume_id = #{resumeId}
        ORDER BY acquisition_date DESC
    </select>

    <!-- 대외활동 관련 쿼리 -->
    <insert id="insertActivity" parameterType="map">
        INSERT INTO r_activity (
            resume_id,
            activity_type,
            organization_name,
            start_date,
            end_date,
            description
        ) VALUES (
            #{resumeId},
            #{activityType},
            #{organizationName},
            #{startDate},
            #{endDate},
            #{description}
        )
    </insert>

    <select id="getActivity" parameterType="int" resultType="map">
        SELECT *
        FROM r_activity
        WHERE resume_id = #{resumeId}
        ORDER BY start_date DESC
    </select>

    <!-- 경력 관련 쿼리 -->
    <insert id="insertCareer" parameterType="map">
        INSERT INTO r_career (
            resume_id,
            career_title,
            start_date,
            end_date
        ) VALUES (
            #{resumeId},
            #{careerTitle},
            #{startDate},
            #{endDate}
        )
    </insert>

    <select id="getCareer" parameterType="int" resultType="map">
        SELECT *
        FROM r_career
        WHERE resume_id = #{resumeId}
        ORDER BY start_date DESC
    </select>

    <!-- 포트폴리오 관련 쿼리 -->
    <insert id="insertPortfolio" parameterType="map">
        INSERT INTO r_portfolio (
            resume_id,
            portfolio_name,
            url,
            file_path
        ) VALUES (
            #{resumeId},
            #{portfolioName},
            #{url},
            #{filePath}
        )
    </insert>

    <select id="getPortfolio" parameterType="int" resultType="map">
        SELECT *
        FROM r_portfolio
        WHERE resume_id = #{resumeId}
    </select>

    <!-- 이력서 수정 관련 쿼리 -->
    <update id="updateResume" parameterType="map">
        UPDATE resume
        SET 
            resume_photo = #{resumePhoto},
            resume_title = #{resumeTitle},
            is_default = #{isDefault},
            updated_at = CURRENT_TIMESTAMP
        WHERE resume_id = #{resumeId}
    </update>

    <!-- 섹션별 삭제 쿼리 -->
    <delete id="deleteEducation" parameterType="int">
        DELETE FROM r_education WHERE resume_id = #{resumeId}
    </delete>

    <delete id="deleteLanguageSkill" parameterType="int">
        DELETE FROM r_language_skill WHERE resume_id = #{resumeId}
    </delete>

    <delete id="deleteCertificate" parameterType="int">
        DELETE FROM r_certificate WHERE resume_id = #{resumeId}
    </delete>

    <delete id="deleteActivity" parameterType="int">
        DELETE FROM r_activity WHERE resume_id = #{resumeId}
    </delete>

    <delete id="deleteCareer" parameterType="int">
        DELETE FROM r_career WHERE resume_id = #{resumeId}
    </delete>

    <delete id="deletePortfolio" parameterType="int">
        DELETE FROM r_portfolio WHERE resume_id = #{resumeId}
    </delete>

    <!-- 이력서 삭제 -->
    <delete id="deleteResume" parameterType="int">
        DELETE FROM resume WHERE resume_id = #{resumeId}
    </delete>

</mapper>