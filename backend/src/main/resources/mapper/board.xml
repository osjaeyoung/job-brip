<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mybatis.board">

    <!-- 공지사항 목록 조회 -->
    <select id="getNoticeList" parameterType="map" resultType="map">
        SELECT 
            notice_id,
            title,
            created_at
        FROM notices
        <where>
            <if test="search != null and search != ''">
                AND (title LIKE CONCAT('%', #{search}, '%') 
                OR content LIKE CONCAT('%', #{search}, '%'))
            </if>
        </where>
        ORDER BY 
        <choose>
            <when test="sort == 'oldest'">created_at ASC</when>
            <otherwise>created_at DESC</otherwise>
        </choose>
    </select>

    <!-- 공지사항 상세 조회 -->
    <select id="getNoticeDetail" parameterType="long" resultType="map">
        SELECT 
            notice_id,
            title,
            content,
            created_at
        FROM notices
        WHERE notice_id = #{noticeId}
    </select>

    <!-- 문의 등록 -->
    <insert id="insertInquiry" parameterType="map">
        INSERT INTO inquiries (
            user_id,
            category,
            title,
            content,
            image_url1,
            image_url2,
            image_url3
        ) VALUES (
            #{userId},
            #{category},
            #{title},
            #{content},
            #{imageUrl1},
            #{imageUrl2},
            #{imageUrl3}
        )
    </insert>

    <!-- 문의 목록 조회 -->
    <select id="getInquiryList" parameterType="string" resultType="map">
        SELECT 
            inquiry_id,
            category,
            title,
            status,
            created_at
        FROM inquiries
        WHERE user_id = #{userId}
        ORDER BY created_at DESC
    </select>

    <!-- 문의 상세 조회 -->
    <select id="getInquiryDetail" parameterType="map" resultType="map">
        SELECT 
            inquiry_id,
            category,
            title,
            content,
            image_url1,
            image_url2,
            image_url3,
            status,
            answer,
            answer_date,
            created_at
        FROM inquiries
        WHERE inquiry_id = #{inquiryId}
        AND user_id = #{userId}
    </select>

</mapper>