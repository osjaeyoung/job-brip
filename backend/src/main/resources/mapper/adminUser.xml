<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mybatis.adminUser">

    <!-- 회원 목록 조회 -->
    <select id="getUserList" parameterType="map" resultType="map">
        SELECT 
            id,
            cuid,
            name,
            nickname,
            email,
            phone,
            DATE_FORMAT(birth_date, '%Y-%m-%d') as birth_date,
            profile_image,
            DATE_FORMAT(created_at, '%Y-%m-%d %H:%i') as created_at
        FROM users
        <where>
            <if test="search != null and search != ''">
                AND (name LIKE CONCAT('%', #{search}, '%') 
                OR nickname LIKE CONCAT('%', #{search}, '%')
                OR email LIKE CONCAT('%', #{search}, '%')
                OR phone LIKE CONCAT('%', #{search}, '%'))
            </if>
        </where>
        ORDER BY 
        <choose>
            <when test="sort == 'oldest'">created_at ASC</when>
            <otherwise>created_at DESC</otherwise>
        </choose>
    </select>

    <!-- 회원 상세 정보 조회 -->
    <select id="getUserDetail" parameterType="long" resultType="map">
        SELECT 
            id,
            cuid,
            name,
            nickname,
            email,
            phone,
            DATE_FORMAT(birth_date, '%Y-%m-%d') as birth_date,
            profile_image,
            DATE_FORMAT(created_at, '%Y-%m-%d %H:%i') as created_at
        FROM users
        WHERE id = #{userId}
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateUser" parameterType="map">
        UPDATE users 
        SET 
            name = #{name},
            nickname = #{nickname},
            phone = #{phone},
            birth_date = #{birthDate}
            <if test="profileImage != null">,
            profile_image = #{profileImage}
            </if>
        WHERE id = #{userId}
    </update>

</mapper>