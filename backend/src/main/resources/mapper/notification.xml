<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- notification.xml -->
<mapper namespace="org.mybatis.notification">
    <!-- 알림 저장 -->
    <insert id="insertNotification" parameterType="map">
        INSERT INTO notification (
            user_id, title, content
        ) VALUES (
            #{userId}, #{title}, #{content}
        )
    </insert>
    
    <!-- 알림 목록 조회 -->
    <select id="getNotifications" parameterType="string" resultType="map">
        SELECT 
            notification_id,
            title,
            content,
            is_read,
            created_at,
            read_at
        FROM notification
        WHERE user_id = #{userId}
        ORDER BY created_at DESC
    </select>
    
    <!-- 알림 읽음 처리 -->
    <update id="markAsRead" parameterType="map">
        UPDATE notification
        SET 
            is_read = true,
            read_at = CURRENT_TIMESTAMP
        WHERE notification_id = #{notificationId}
        AND user_id = #{userId}
    </update>
    
    <!-- 전체 알림 읽음 처리 -->
    <update id="markAllAsRead" parameterType="string">
        UPDATE notification
        SET 
            is_read = true,
            read_at = CURRENT_TIMESTAMP
        WHERE user_id = #{userId}
        AND is_read = false
    </update>    
</mapper>